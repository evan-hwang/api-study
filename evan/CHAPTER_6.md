## 6. 예측 가능한 API 디자인하기

이 장의 내용

- 일관성을 유지하여 직관적인 API 만들기
- 사용 간소화 및 사용자 적응 기능을 추가하기(?)
- 사용자 가이드를 위한 메타데이터와 메타골 추가



API를 처음 사용하는 사람이라도 아무 생각 없이 본능적으로 사용할 수 있게 하자. 

과거 경험했던 것과 유사하게 만들거나 사용자의 의도에 맞게 만들거나 제대로 사용할 수 있는 정보를 제공하자.

---

### 6.1 일관성 유지하기

*"일관성 있는 디자인에는 변형이나 모순이 없다."*



> ⚠️ 주의
>
> 훌륭햔 API를 만들겠다고 일관성에 너무 치중하여 사용성을 해치는건 안된다!



#### 6.1.1 일관된 데이터 디자인하기

일관된 데이터에는 크게 다음의 세가지가 있다.

- 이름 일관성
- 포맷 일관성
- URL 일관성



#### 6.1.2 일관적인 목표 디자인하기

- 목표의 입력이 일관적이어야함
- 성공이나 실패 피드백의 응답이 일관적이어야함
- 에러메시지는 일관적이어야함



#### 6.1.3 일관성의 4단계

1. API 내부에 일관성
   - 각각의 API들이 서로의 일관성을 해치면 안된다.
2. 팀 API / 회사 / 조직 간의 일관성
   - 팀의 일관성을 지켜야한다.
3. 도메인간의 API 일관성
   - 특정 도메인에서 작업할 때 지켜야할 표준에 대한 관행을 지켜야한다.
4. 외부 세계와 일관성
   - 바로 사용할 수 있게하는 관행을 지켜야한다. 

이러한 일관성을 준수하면 이전에 API를 사용해 본 적이 없는 사람들도 API에 대해 바로 예측하고 사용할 수 있게 된다.



#### 6.1.4 타인을 따라하자: 일반적인 관행과 표준 준수하기

REST API는 이러한 API에 대한 표준을 제시한다. 

문서화된 HTTP 프로토콜의 규칙을 준수하자.



#### 6.1.5 유지하기 어렵고 현명하게 적용해야하는 일관성

*"일관성은 중요하지만, 그 대가로 사용성을 저해시키거나 상식에 반대되서는 안된다."*



---

### 6.2 적응 가능하게 하기

*"예측할 수 있고 다른 유형의 유저들까지 고려해서 제공해 그들을 만족시키자."*

- 여러 포맷 제공
- 국제화와 현지화
- 필터, 페이지, 정렬 



#### 6.2.1 다른 포맷으로 제공하거나 응답하기

REST 아키텍처 스타일에서는 모든 상호작용이 리소스의 상태와 표준 HTTP 메서드, 그리고 이것들이 무엇을 의미하는지와 해당 리소스에서 무슨 일이 벌어졌는지 알 수 있는 모든 메타 데이터를 제공해야한다.



1. 쿼리 스트링으로 제공 포맷을 지정할 수 있게한다.
   - ex) GET /sccounts/{accountId}/transactions?format=CSV
2. HTTP 프로토콜을 이용해서 컨텐츠 네고시에이션을 제공하는 방법
   - 요청 헤더에 Accept: text/csv
   - 응답 헤더에 Content-type: text/csv 



#### 6.2.2 국제화와 현지화

RFC 5646에 정의된 방식으러 언어 코드와 국가 코드를 사용해서 전달하기

- 요청 헤더 : Accept-Language : ko-KR
- 응답 헤더 : Content-Language : ko-KR

데이터의 국제화 뿐 아니라 현지화를 통해 해당 국가에서 사용하는 데이터의 포맷을 제공해야한다.



#### 6.2.3 필터, 페이지, 정렬 적용하기

페이징과 필터링, 정렬을 제공하자.



---

### 6.3 탐색 가능하게 하기

책에서 페이지나 목차로 탐색을 하듯 REST API는 탐색에 대한 정보를 제공할 수 있다.



#### 6.3.1 메타데이터 제공하기

각 응답에서 할 수 있는 액션 목록을 제공한다.

```json
"pagination": {							// 현재 무슨 페이지를 보고 있는지에 대한 메타 데이터
  "page": 1,
  "totalPages": 9
},
"items": [
  {
    "id": "20302041",
    ...,
    "actions": ["cancel"]		// 해당 아이템에서 할 수 있는 동작에 대한 메타 데이터
  }
]
```





#### 6.3.2 하이퍼미디어 API 만들기

각 API에서 사용할 수 있는 API에 대한 링크를 제공하자.

```json
"pagination": {							
  "page": 1,
  "totalPages": 9,
  "next": "/accounts/20302041/transactions?page=2",
  "last": "/accounts/20302041/transactions?page=9"
},
{
  "items": [
    {
      "id": "20302041",
      ...,
      "href": "/accounts/20302041"
    }
	]
}
```





#### 6.3.3 HTTP 프로토콜의 장점 이용하기

표준이 없으니 아직은 사용하지 말자. 



---

### 요약

- 동작을 추측할 수 있는 API를 작성하려면 일관된 규칙을 정의하고 표준을 준수하자.
- API가 다른 표현을 지원하거나 국제화, 현지화를 지원해야 하는지 확인하자.
- 목록 형태의 목표를 제공해야한다면 페이지, 필터, 정렬 기능이 추가될수록 좋다.
- 컨슈머에게 API를 안내하기 위해 가능한 많은 메타데이터를 제공하자.